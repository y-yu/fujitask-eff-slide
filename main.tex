\usepackage{luatexja}
\usepackage[hiragino-pron, nfssonly, deluxe, expert]{luatexja-preset}
\usepackage{pgfpages}
\usepackage{fontspec}
\usepackage{epigraph}
\usepackage{etoolbox}
\usepackage{tikz}
\usepackage{framed}
\usepackage{mathtools}
\usepackage{listings}
\usepackage{libertine}
\usepackage{bxcoloremoji}
\usepackage{xcolor}
\usepackage{multirow}
\usepackage{diagbox}
\usepackage{caption}
\usepackage{tikz-qtree}

\definecolor{links}{HTML}{2A1B81}
\hypersetup{colorlinks,linkcolor=,urlcolor=links}

\usetheme{Boadilla}
\usecolortheme{seahorse}
% \usefonttheme{serif}

\setbeamercolor{page number in head/foot}{bg=blue!10}
\makeatother
\setbeamertemplate{footline}
{
  \leavevmode%
  \hbox{%
    \begin{beamercolorbox}[wd=.4\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
      \usebeamerfont{author in head/foot}\insertshortauthor\hspace*{1ex}(\insertshortinstitute)
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.3\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
      \usebeamerfont{title in head/foot}\insertshorttitle
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.2\paperwidth,ht=2.25ex,dp=1ex,center]{date in head/foot}%
      \insertshortdate
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.1\paperwidth,ht=2.25ex,dp=1ex,center]{page number in head/foot}%
      \insertframenumber{} / \inserttotalframenumber\hspace*{1ex}
    \end{beamercolorbox}}%
  \vskip0pt%
}
\makeatletter

\beamertemplatenavigationsymbolsempty

\setbeamertemplate{bibliography item}{\insertbiblabel}
\setbeamersize{description width=1cm}
\setbeamertemplate{items}[circle]
\setbeamertemplate{section in toc}[circle]
\setbeamertemplate{subsection in toc}{%
  \leavevmode\leftskip=2em
  {%
    \usebeamerfont*{itemize item}%
    \usebeamercolor{subsection number projected}%
    \color{bg}%
    \raise1.25pt\hbox{\donotcoloroutermaths$\bullet$}}%
  \hskip1.5ex\inserttocsubsection\par}
\setbeamercolor{title}{bg=white}
\setbeamertemplate{title page}
{%
  \vbox{}
  \vfill
  \begingroup
    \centering
    \hrulefill
    \vskip1em\par
    \begin{beamercolorbox}[sep=8pt,center,shadow=false,rounded=true]{title}
      \usebeamerfont{title}\inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else%
        \vskip0.25em%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
      \fi%     
    \end{beamercolorbox}%
    \hrulefill
    \vskip1em\par
    \begin{beamercolorbox}[sep=8pt,center,shadow=false,rounded=true]{author}
      \usebeamerfont{author}\insertauthor
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,center,shadow=false,rounded=true]{institute}
      \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}
    \begin{beamercolorbox}[sep=8pt,center,shadow=false,rounded=true]{date}
      \usebeamerfont{date}\insertdate
    \end{beamercolorbox}\vskip0.5em
    {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
  \endgroup
  \vfill
}
\setbeamertemplate{blocks}[rounded][shadow=false]
\setbeamertemplate{note page}{\pagecolor{yellow!5}\insertnote}


% ============ ã“ã“ã‚’æ¶ˆã™ã¨Noteæ¶ˆãˆã‚‹ ================
% \mode<handout>{%
%   \setbeameroption{show notes on second screen=right}%
% }
% ============ ã“ã“ã‚’æ¶ˆã™ã¨Noteæ¶ˆãˆã‚‹ ================


\renewcommand{\kanjifamilydefault}{\gtdefault}

\resetcounteronoverlays{lstlisting}
\definecolor{bluegray}{rgb}{0.4, 0.6, 0.8}
\DeclareCaptionFormat{listing}{{\color{bluegray}\lstlistingname}#2#3}
\captionsetup[lstlisting]{format=listing, font={footnotesize}}

\setmonofont[Ligatures=TeX]{CMU Typewriter Text}

\newcommand{\xcolon}{ï¼š}
\newcommand{\Fujitask}{{\rmfamily\bfseries Fujitask}}

\title[Fujitask meets Extensible Effects]{%
  {\bfseries\rmfamily\mcfamily\huge\scshape
    \Fujitask \\
    meets\\
    Extensible Effects%
  }%
}
\author[Hikaru Yoshimura]{%
  Hikaru \textsc{Yoshimura}ï¼ˆå‰æ‘ å„ªï¼‰
}
\date[ScalaMatsuri, June 209 2019]{%
  \href{https://www.tryswift.co/events/2019/tokyo/en/}{ScalaMatsuri on \oldstylenums{June 29, 2019}} \\
  {\scriptsize (\href{https://github.com/y-yu/fujitask-eff-slide}{\texttt{y-yu/fujitask-eff-slide@\GITAbrHash}})}%
}
\institute[Recruit Markting Partners Co., Ltd.]{%
  Recruit Markting Partners Co., Ltd.\\
  \href{mailto:yyu@mental.poker}{yyu@mental.poker}
}

\input{./lib/quotebox.tex}
\input{./lib/footnotemark.tex}
\input{./lib/ballon.tex}
\input{./lib/listings.tex}
\input{vc.tex}

\setbeamertemplate{items}[circle]

\newcommand\ballcircle[1]{%
  {%
    \usebeamercolor{enumerate item}%
    \tikzset{beameritem/.style={circle,inner sep=0,minimum size=2ex,text=enumerate item.bg,fill=enumerate item.fg,font=\footnotesize}}%
    \tikz[baseline=(n.base)]\node(n)[beameritem]{#1};%
  }
}
\newcommand\ballref[1]{%
  \ballcircle{\ref{#1}}
}

\newcommand\ce[1]{%
  \coloremoji{#1}
}

\newenvironment{notes}
  {%
    \begin{xlrbox}{NotesBox}
    \begin{minipage}{.95\textwidth}
    \small\rmfamily\mcfamily
    \begin{itemize}
    \setlength{\itemindent}{0em}
  }{%
    \end{itemize}
    \end{minipage}
    \end{xlrbox}
    \note{\theNotesBox}}

\makeatletter
\newsavebox\temp@simple@callout@box
\newcommand{\simplecallout}[3]{%
  \sbox{\temp@simple@callout@box}{\mbox{#3}}%
  \begin{center}%
    \begin{tikzpicture}%
      \calloutquote[width=1.1\wd\temp@simple@callout@box,position={(#1.5,-0.2)},fill=#2,rounded corners]{
        #3%
      }%
    \end{tikzpicture}%
  \end{center}
}
\makeatother

\begin{document}

\frame{\maketitle}

\begin{frame}
  \frametitle{ç›®æ¬¡}

  \tableofcontents
\end{frame}

\section{è‡ªå·±ç´¹ä»‹}
\begin{frame}
  \frametitle{è‡ªå·±ç´¹ä»‹}
  
  \begin{columns}
    \begin{column}{0.4\textwidth}
      \begin{center}
        \begin{figure}
          \includegraphics[width=0.95\textwidth]{img/bird2x_big_gifu.png}
        \end{figure}
      \end{center}
 
      \begin{table}[h]
        \begin{tabular}{ll}
          Twitter & \href{https://twitter.com/\_yyu\_}{@\_yyu\_} \\
          Qiita &  \href{https://qiita.com/yyu}{yyu} \\
          GitHub &  \href{https://github.com/y-yu}{y-yu} \\
        \end{tabular}
      \end{table}
    \end{column}
    \begin{column}{0.6\textwidth}
      \pause
      \begin{itemize}
        \item<+-> ç­‘æ³¢å¤§å­¦ æƒ…å ±ç§‘å­¦é¡å’ï¼ˆå­¦å£«ï¼‰
        \item<+-> ãƒ—ãƒ­ã‚°ãƒ©ãƒ è«–ç†ç ”ç©¶å®¤
        \item<+-> \LaTeX ã¨ã‹Scalaã¨ã‹
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}

\section{ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ï¼Ÿ}

\begin{frame}
  \frametitle{ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ï¼Ÿ}

  \pause
  \begin{itemize}
    \item<+-> \textbf{ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³}ã¯æ¬¡ã‚’æº€ã™
  \end{itemize}

  \begin{uncoverenv}<+->
    \begin{shadequote}[r]{}
      \begin{itemize}
        \item å…¨æ“ä½œãŒå®Œäº†ã™ã‚‹ã¾ã§ã€ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ã¯ãã®é€”ä¸­ã®çŠ¶æ…‹ã‚’è¦³æ¸¬ã§ããªã„
        \item ã„ãšã‚Œã‹ã®æ“ä½œãŒå¤±æ•—ã—ãŸå ´åˆã¯å…¨ã¦ãŒå¤±æ•—ã¨ãªã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯æ“ä½œã‚’è¡Œã†å‰ã®çŠ¶æ…‹ã«æˆ»ã‚‹
      \end{itemize}
    \end{shadequote}
  \end{uncoverenv}

  \begin{itemize}
    \item<+-> ãŸã¨ãˆã°ã€Œèª²é‡‘ã—ãŸãªã‚‰ã°ã‚³ãƒ¼ãƒãƒ³ã‚°æ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã€
    ã‚³ãƒ¼ãƒã‚’ã‚¢ã‚µã‚¤ãƒ³ã™ã‚‹ã€ã¨ã„ã†æ¬¡ã®ã‚ˆã†ãªå‡¦ç†ãŒã‚ã‚‹
    \begin{enumerate}
      \item èª²é‡‘å±¥æ­´ã®æ›´æ–°
      \item ã‚³ãƒ¼ãƒãƒ³ã‚°æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã¨ã„ã†æ¨©é™ç®¡ç†ã®æ›´æ–°
      \item ã‚³ãƒ¼ãƒã®ã‚¢ã‚µã‚¤ãƒ³æƒ…å ±ã®æ›´æ–°
    \end{enumerate}
    
    \item<+-> ã“ã‚Œã‚‰ã®ã†ã¡ã©ã‚Œã‹ã²ã¨ã¤ã§ã‚‚å¤±æ•—ã—ãŸãªã‚‰ã°ä¸­é€”åŠç«¯ãªçŠ¶æ…‹ã«ã¯ãªã‚‰ãšã€
    ãªã«ã‚‚ã—ãªã‹ã£ãŸçŠ¶æ…‹ã¨ãªã‚‹
  \end{itemize}
\end{frame}

\section{ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚„ã‚Šæ–¹}

\begin{frame}[fragile]
  \frametitle{ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚„ã‚Šæ–¹}

  \pause
  \begin{enumerate}
    \item<+-> \texttt{BEGIN}ã¨\texttt{COMMIT}ã«ç›¸å½“ã™ã‚‹
    é–¢æ•°ã‚’ç”¨æ„ã—ã¦ãã‚Œã‚‰ã‚’å®Ÿè¡Œã™ã‚‹
  \end{enumerate}

  \begin{uncoverenv}<+->
\begin{lstlisting}[style=scala]
val transactionManager = new TM()

transactionManager.begin()

something.databaseOperation()

transactionManager.commit()
\end{lstlisting}
  \end{uncoverenv}

  \begin{itemize}
    \item<+-> \lstinline|begin|ã¨ã‹\lstinline|commit|ã‚’å¿˜ã‚ŒãŸã‚‰çµ‚ã‚ã‚Š

    \item<+-> Cè¨€èªã¨ã„ã£ãŸè¡¨ç¾åŠ›ã®ä½ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èªã§ã¯ã€ã“ã®ã‚ˆã†ãª
    ã‚¹ã‚¿ã‚¤ãƒ«ã—ã‹ã§ããªã‹ã£ãŸ
    \begin{itemize}
      \item<+-> ãŸã¨ãˆã°ã€ã‹ã¤ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¯ã“ã‚“ãªã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã§
      ãƒ­ãƒƒã‚¯ã™ã‚‹ãªã©ã—ã¦ã„ãŸ
    \end{itemize}

    \item<+-> æœ€è¿‘ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èªã§ã“ã®ã‚ˆã†ãªæ–¹æ³•ã‚’ä½¿ã†ã“ã¨ã¯å°‘ãªã„
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚„ã‚Šæ–¹}

  \begin{enumerate}
    \setcounter{enumi}{1}
    \item<+-> \label{enum:loan} é«˜éšé–¢æ•°ã‚’åˆ©ç”¨ã™ã‚‹ï¼ˆãƒ­ãƒ¼ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
  \end{enumerate}

  \begin{uncoverenv}<+->
\begin{lstlisting}[style=scala]
def withTransaction(f: Session => Unit): Unit = {
  val transactionManager = new TM()

  transactionManager.begin()
  f(transactionManager.session)
  transactionManager.commit()
}

withTransaction { session =>
  something.databaseOperation(session)
}
\end{lstlisting}
  \end{uncoverenv}

  \begin{itemize}
    \item<+-> é–¢æ•°ã‚’å¼•æ•°ã¨ã—ã¦æ¸¡ã›ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èªã§ã¯ã‚ˆãåˆ©ç”¨ã•ã‚Œã‚‹
    \begin{itemize}
      \item<+-> é–¢æ•°ãŒå¼•æ•°ã¨ã—ã¦æ¸¡ã›ãªãã¨ã‚‚ã€é–¢æ•°ã‚’è¡¨ã™ã‚ˆã†ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’
      åˆ©ç”¨ã™ã‚‹ã“ã¨ã§æ˜”ã®Javaãªã©ã§ã‚‚åˆ©ç”¨ã§ããŸ
    \end{itemize}
      
    \item<+-> æœ€è¿‘ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èªã§ã¯ã“ã®æ–¹æ³•ã‚’ä½¿ã†ã“ã¨ãŒå¤šã„ï¼ˆï¼Ÿï¼‰
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚„ã‚Šæ–¹}

  \begin{itemize}
    \item<+-> \ballref{enum:loan}ã®ãƒ­ãƒ¼ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ãˆã°è§£æ±ºã‹ï¼Ÿ
    \begin{itemize}
      \item<+-> ã¨ã¯ã„ãˆã€\lstinline|withTransaction|ã‚’å¿˜ã‚ŒãŸã‚‰çµ‚ã‚ã‚Š
    \end{itemize}
    
    \item<+-> ã•ã‚‰ã«ã€æ¬¡ã®ã‚ˆã†ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ãŒãƒŸã‚¹ã§äºŒé‡ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’
    è²¼ã£ã¦ã—ã¾ã£ãŸã‚‰ã©ã†ãªã‚‹ã ã‚ã†ï¼Ÿ    
  \end{itemize}

  \begin{uncoverenv}<+->
\begin{lstlisting}[style=scala]
def somethingOperation(): Unit = {
  withTransaction { something.databaseOperation }
}
    
withTransaction { somethingOperation }
\end{lstlisting}
  \end{uncoverenv}

  \begin{itemize}
    \item<+-> ã•ã‚‰ã«ã€2ã¤ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’çµåˆã—ãŸããªã£ãŸã¨ã—ã¦ã‚‚ã€
    æ–°ã—ãå‡¦ç†ã‚’æ›¸ã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„
    
    \item<+-> ãã‚‚ãã‚‚ã€å¤šãã®å ´åˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã‹ã©ã†ã‹ã¯SQLã‹ã‚‰åˆ¤å®šã§ãã‚‹
    
    \item<+-> ã«ã‚‚é–¢ã‚ã‚‰ãšã€ãƒ­ãƒ¼ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯SQLã‚’\textbf{ä½¿ã†æ™‚ã«}
    ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒå¿…è¦ã‹ã‚’åˆ¤æ–­ã—ã¦ã„ã‚‹
  \end{itemize}
\end{frame}

\section{ãƒ¢ãƒŠãƒ‰ç‰ˆ\protect\Fujitask}

\subsection{\protect\Fujitask ã¨ã‚µãƒ–ã‚¿ã‚¤ãƒ—}

\begin{frame}
  \frametitle{\Fujitask ã¨ã¯ï¼Ÿ}

  \pause
  \begin{uncoverenv}<+->
    \begin{block}{\Fujitask}
      ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆãƒ¢ãƒŠãƒ‰ï¼‰
    \end{block}
  \end{uncoverenv}

  \begin{itemize}
    \item<+-> ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è²¼ã‚‹ã‹ã©ã†ã‹ï¼Ÿã‚’\textbf{ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚}ã«
    åˆ¤æ–­ã—ã¦ãã‚Œã‚‹

    \item<+-> ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã®æ˜ç¤ºçš„ãªæ“ä½œãªã—ã«é©åˆ‡ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®é–‹å§‹ã¨è§£æ”¾ãŒ
    å®Ÿè¡Œã•ã‚Œã€ã‹ã¤ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒäºŒé‡ãƒ»ä¸‰é‡ã«ãªã£ãŸã‚Šã—ãªã„

    \item<+-> ã‹ã¤ã¦ãƒ‰ãƒ¯ãƒ³ã‚´ã«ã„ãŸè—¤ç”°ã•ã‚“ãŒé–‹ç™ºã—ãŸãŸã‚ã€ã“ã®ã‚ˆã†ã«å‘¼ã°ã‚Œã¦ã„ã‚‹
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{\Fujitask ã¨ã¯ï¼Ÿ}

  \begin{itemize}
    \item<+-> å®šç¾©ã¯æ¬¡ã¨ãªã‚‹
  \end{itemize}

  \begin{uncoverenv}<+->
\begin{lstlisting}[style=scala]
trait Task[-R, +A] { lhs =>
  def execute(r: R)(implicit ec: EC): Future[A]

  def flatMap[ER <: R, B](f: A => Task[ER, B]): Task[ER, B] =
    new Task[ER, B] {
      def execute(r: ER)(implicit ec: EC): Future[B] =
        lhs.execute(r).map(f).flatMap(_.execute(r))
    }

  def map[B](f: A => B): Task[R, B] = flatMap(a => Task(f(a)))

  def run[ER <: R]()(implicit runner: TaskRunner[ER]): Future[A] =
    runner.run(lhs)
}
\end{lstlisting}
  \end{uncoverenv}

  \begin{itemize}
    \item<+-> \lstinline|flatMap|ã«\textbf{ã‚µãƒ–ã‚¿ã‚¤ãƒ—}ã‚’ä½¿ã£ã¦ã„ã‚‹ï¼

    \item<+-> Haskellã«ã¯ã‚µãƒ–ã‚¿ã‚¤ãƒ—ãŒç„¡ã„ã¨ã‚ˆãçŸ¥ã‚‰ã‚Œã¦ã„ã‚‹ãŒã€
    ãªãœã“ã®ãƒ¢ãƒŠãƒ‰ã¯ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã‹ï¼Ÿ
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã¨åŠé †åºé›†åˆ}

  \pause
  \begin{block}{ã‚µãƒ–ã‚¿ã‚¤ãƒ—}
    å‹$B$ãŒå‹$A$ã®æœŸå¾…ã•ã‚Œã¦ã„ã‚‹å ´æ‰€ã§å®‰å…¨ã«ä½¿ç”¨å¯èƒ½ã§ã‚ã‚‹ã¨ãã€
    $B$ã¯$A$ã®\textbf{ã‚µãƒ–ã‚¿ã‚¤ãƒ—}ã§ã‚ã‚‹

    \begin{itemize}
      \item å‹$B$ãŒå‹$A$ã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã§ã‚ã‚‹ã¨ã$B <: A$ã¨è¡¨è¨˜ã™ã‚‹
    \end{itemize}
  \end{block}

  \pause
  \begin{itemize}
    \item<+-> ã‚µãƒ–ã‚¿ã‚¤ãƒ—é–¢ä¿‚ã«ã¯æ¬¡ã®ã‚ˆã†ãªç‰¹å¾´ãŒã‚ã‚‹
    \begin{enumerate}
      \item<+-> ä»»æ„ã®å‹$A$ã«ãŠã„ã¦ã€$A <: A$ã§ã‚ã‚‹ï¼ˆåå°„ï¼‰
      \item<+-> ä»»æ„ã®å‹$A, B, C$ã«ãŠã„ã¦ã€$C <: B$ã‹ã¤$B <: A$ãªã‚‰ã°$C <: A$ã§ã‚ã‚‹ï¼ˆæ¨ç§»ï¼‰
      \item<+-> ä»»æ„ã®å‹$A, B$ã«ãŠã„ã¦ã€$B <: A$ã‹ã¤$A <: B$ãªã‚‰ã°$A = B$ã§ã‚ã‚‹ï¼ˆåå¯¾ç§°ï¼‰
    \end{enumerate}

    \item<+-> ã“ã®ã‚ˆã†ãªé–¢ä¿‚ã¨é›†åˆã‚’\textbf{åŠé †åºé›†åˆ}ã¨è¨€ã„ã€
    å‹ã¨ã‚µãƒ–ã‚¿ã‚¤ãƒ—é–¢ä¿‚ã¯åŠé †åºé›†åˆã¨ãªã‚‹
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã¨æŸ}

  \pause
  \begin{itemize}
    \item<+-> Scalaã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—é–¢ä¿‚ã¯\textbf{æŸ}ã‚’ä½œã‚‹
  \end{itemize}

  \begin{uncoverenv}<+->
    \begin{block}{æŸ}
      ä»»æ„ã®2ã¤ã®å…ƒãŒä¸€æ„ãªä¸Šé™ãŠã‚ˆã³ä¸‹é™ã‚’æŒã¤åŠé †åºé›†åˆã®ã“ã¨
    \end{block}
  \end{uncoverenv}

  \begin{columns}
    \begin{column}{0.3\textwidth}
      \begin{center}
        \begin{uncoverenv}<+->
          \begin{tikzpicture}[scale=.8]
            \Tree[.Any
                      [.{$\vdots$} [.Integer \edge[roof]; {$\vdots$} ] ]
                      [.{$\vdots$} [.String \edge[roof]; {$\vdots$} ] ]
                      [.{$\vdots$} [.Boolean \edge[roof]; {$\vdots$} ] ] ]
          \end{tikzpicture}
                    
          \begin{tikzpicture}[scale=.8]
            \tikzset{grow'=up}
            \Tree[.Nothing \edge[roof]; { \hspace{90pt} } ]
          \end{tikzpicture}
        \end{uncoverenv}
      \end{center}
    \end{column}

    \begin{column}{0.7\textwidth}
      \begin{itemize}
        \item<+-> ã©ã‚“ãª2ã¤ã®å…ƒã‚‚ã€ä¸€æ„ãªå…±é€šã®ç¥–å…ˆã¨å­å­«ã‚’ãã‚Œãã‚ŒæŒã¤
        \item<+-> å‹ã‚·ã‚¹ãƒ†ãƒ ç†è«–ã«ãŠã„ã¦ã¯ã€ãƒœãƒˆãƒ ï¼ˆ\lstinline|Nothing|ï¼‰ã‚’
        å…¥ã‚Œã‚‹ã¨è¤‡é›‘ã«ãªã‚‹ã¨çŸ¥ã‚‰ã‚Œã¦ãŠã‚Šé¿ã‘ã‚‰ã‚Œã‚‹å‚¾å‘ã«ã‚ã‚‹ãŒã€Scalaã«ã¯å…¥ã£ã¦ã„ã‚‹
        \item<+-> ãã®ãŸã‚ã€Scalaã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—é–¢ä¿‚ã¯æŸã¨ãªã‚‹
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}[fragile]
  \frametitle{ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¨æŸ}
 
  \begin{itemize}
    \item<+-> å®Ÿã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯æŸæ§‹é€ ã‚’ä½œã‚‹
    \item<+-> ãã—ã¦ã€ãã®æŸã¨ãªã£ãŸãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’
    ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã§è¡¨ç¾ã™ã‚‹
  \end{itemize}

  \begin{columns}
    \begin{column}{0.3\textwidth}
      \begin{uncoverenv}<+->
        \begin{tikzpicture}[scale=.8]
          \begin{scope}
            \Tree[.NoTransaction
                          \node(s1){ReadSlave1};
                          \node(s2){ReadSlave2}; ]
          \end{scope}
                        
          \begin{scope}[yshift=-60pt]
            \Tree[.\node(r){ReadMaster}; Write ]
          \end{scope}
       
          \begin{scope}
            \draw (s1.south)--(r.north);
            \draw (s2.south)--(r.north);
          \end{scope}
        \end{tikzpicture}
      \end{uncoverenv}
    \end{column}

    \begin{column}{0.7\textwidth}
      \begin{uncoverenv}<+->
\begin{lstlisting}[style=scala]
trait NoTransaction
 
trait ReadSlave1 extends NoTransaction

trait ReadSlave2 extends NoTransaction
 
trait ReadMaster
  extends ReadSlave1 with ReadSlave2

trait Write extends ReadMaster
\end{lstlisting}
      \end{uncoverenv}
    \end{column}
  \end{columns}

  \begin{itemize}
    \item<+-> ã‚µãƒ–ã‚¿ã‚¤ãƒ—é–¢ä¿‚ã‚’ä½¿ã£ã¦ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æŸæ§‹é€ ã‚’
    ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã«\textbf{å‹ãƒ¬ãƒ™ãƒ«}ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ããŸ
  \end{itemize}
\end{frame}
 
\begin{frame}[fragile]
  \frametitle{\Fujitask ã¨åˆæˆ}
 
  \pause
  \begin{itemize}
    \item<+-> \Fujitask ã®åˆæˆæ¼”ç®—ã§ã‚ã‚‹\lstinline|flatMap|ã¯
    æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹
  \end{itemize}
    
  \begin{uncoverenv}<+->
\begin{lstlisting}[style=scala]
trait Task[-R, +A] {
  def flatMap[ER <: R, B](f: A => Task[ER, B]): Task[ER, B]
}
\end{lstlisting}
  \end{uncoverenv}
 
  \begin{itemize}
    \item<+-> ã“ã‚Œã¯ãŸã¨ãˆã°æ¬¡ã®ã‚ˆã†ã«ãªã‚‹
    \begin{enumerate}
      \item<+-> \lstinline|Task[ReadSlave1, A]|ã¨
      \lstinline|Task[ReadSlave1, B]|ã‚’åˆæˆã—ãŸã‚‰ã€\lstinline|Task[ReadSlave1, B]|ã¨ãªã‚‹
 
      \item<+-> \lstinline|Task[ReadSlave1, A]|ã¨
      \lstinline|Task[ReadSlave2, B]|ã‚’åˆæˆã—ãŸã‚‰ã€\lstinline|Task[ReadMaster, B]|ã¨ãªã‚‹
 
      \item<+-> \lstinline|Task[ReadSlave1, A]|ã¨
      \lstinline|Task[ReadMaster, B]|ã‚’åˆæˆã—ãŸã‚‰ã€\lstinline|Task[ReadMaster, B]|ã¨ãªã‚‹
    \end{enumerate}
  \end{itemize}
\end{frame}

%ã€€\begin{frame}[fragile]
%ã€€  \frametitle{\Fujitask ã®å®Ÿè¡Œ}
%ã€€ 
%ã€€  \pause
%ã€€  \begin{itemize}
%ã€€    \item<+-> \Fujitask ã«ã¯\lstinline|run|ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹
%ã€€  \end{itemize}
%ã€€  
%ã€€  \begin{uncoverenv}<+->
%ã€€\begin{lstlisting}[style=scala]
%ã€€trait Task[-R, +A] { lhs =>
%ã€€  def run[ER <: R]()(implicit runner: TaskRunner[ER]): Future[A]
%ã€€}
%ã€€\end{lstlisting}
%ã€€  \end{uncoverenv}
%ã€€ 
%ã€€  \begin{itemize}
%ã€€    \item<+-> \lstinline|TaskRunner|ã¯æ¬¡ã®ã‚ˆã†ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
%ã€€    ã‚’ã©ã†ã™ã‚‹ã‹ã‚’å®šç¾©ã§ãã‚‹
%ã€€  \end{itemize}
%ã€€ 
%ã€€  \begin{uncoverenv}<+->
%ã€€\begin{lstlisting}[style=scala]
%ã€€trait TaskRunner[R] {
%ã€€  def run[A](task: Task[R, A]): Future[A]
%ã€€}
%ã€€\end{lstlisting}
%ã€€  \end{uncoverenv}
%ã€€\end{frame}
%ã€€ 
%ã€€\begin{frame}[fragile]
%ã€€  \frametitle{\Fujitask ã®å®Ÿè¡Œ}
%ã€€ 
%ã€€  \begin{itemize}
%ã€€    \item<+-> ã‚ã¨ã¯\lstinline|TaskRunner|ã®å®Ÿè£…ã‚’æ›¸ã‘ã°OK
%ã€€  \end{itemize}
%ã€€ 
%ã€€  \begin{uncoverenv}<+->
%ã€€\begin{lstlisting}[style=scala]
%ã€€implicit val writeTaskRunner: TaskRunner[Write] =
%ã€€  new TaskRunner[Write] {
%ã€€    private val transactionManager = new TM()
%ã€€    
%ã€€    def run[A](task: Task[Write, A]): Future[A] = {
%ã€€      transactionManager.begin()
%ã€€      task.execute(new Write {})
%ã€€      transactionManager.commmit()
%ã€€    }
%ã€€  }
%ã€€\end{lstlisting}
%ã€€  \end{uncoverenv}
%ã€€ 
%ã€€  \begin{itemize}
%ã€€    \item<+-> \lstinline|implicit|ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ç¨®é¡ã‚’è¡¨ã™å‹ã«
%ã€€    ã‚‚ã¨ã¥ã„ãŸ\lstinline|TaskRunner|ã®å®Ÿè£…ãŒ\textbf{ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚}ã«é¸æŠã•ã‚Œã‚‹
%ã€€  \end{itemize}
%ã€€\end{frame}

\begin{frame}[fragile]
  \frametitle{\Fujitask ã®å®Ÿè¡Œ}

  \begin{itemize}
    \item<+-> \Fujitask ã¯ãƒ¢ãƒŠãƒ‰ãªã®ã§ã€\lstinline|for|å¼ã§
    ã¾ã¨ã‚ã¦ã„ãã“ã¨ãŒã§ãã‚‹
  \end{itemize}

  \begin{uncoverenv}<+->
\begin{lstlisting}[style=scala]
val transaction = for {
  _ <- paymentRepository.update(payment)
  _ <- userPermissionRepository.update(userPermission)
  _ <- coachRepository.assgin(coach, user)
} yield ()

transaction.run()
\end{lstlisting}
  \end{uncoverenv}

  \begin{itemize}
    \item<+-> ãƒ¢ãƒŠãƒ‰æ§‹æ–‡ã§ã™ã£ãã‚Šæ›¸ã‘ã‚‹

    \item<+-> ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã€
    é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®å‹ã‚¯ãƒ©ã‚¹ãƒ»ãƒ¢ãƒŠãƒ‰ãŒç¾ã—ãèåˆã—ã¦ã„ã‚‹
    \begin{itemize}
      \item ã‚µãƒ–ã‚¿ã‚¤ãƒ—ãŒãªã„Haskellã€ãƒ¢ãƒŠãƒ‰æ§‹æ–‡ãƒ»å‹ã‚¯ãƒ©ã‚¹ãŒãªã„Javaã«\Fujitask ã¯å®Ÿè£…ã§ããªã„
    \end{itemize}
  \end{itemize}
\end{frame}


\begin{frame}
  \frametitle{ã“ã“ã¾ã§ã®ã¾ã¨ã‚}

  \pause
  \begin{itemize}
    \item<+-> ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ã—ã°ã—ã°æŸæ§‹é€ ã‚’æˆã™
    \item<+-> æŸæ§‹é€ ã‚’å‹ãƒ¬ãƒ™ãƒ«ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹æ‰‹æ®µã¨ã—ã¦ã‚µãƒ–ã‚¿ã‚¤ãƒ—ãŒä½¿ãˆã‚‹
    \item<+-> æŸæ§‹é€ ã«åŸºã¥ãã‚¢ãƒ‰ãƒ›ãƒƒã‚¯ãªå‡¦ç†ã‚’ã€ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã¨å‹ã‚¯ãƒ©ã‚¹ã§å®Ÿç¾ã§ãã‚‹
    \item<+-> ã‚ªãƒ–ã‚¸ãƒ§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¯ç¾ã—ãèåˆã•ã‚Œã†ã‚‹
  \end{itemize}
\end{frame}

\section{\Fujitask ã¨Extensible Effects}

\begin{frame}
  \frametitle{Extensible Effects}

  \pause
  \begin{itemize}
    \item<+-> \textbf{ãƒ¢ãƒŠãƒ‰}ã¯1ã¤ã®\textbf{åŠ¹æœ}%
    \footnote[frame]{å‰¯ä½œç”¨ã®ã“ã¨ã€‚æœ€è¿‘ã ã¨``è¨ˆç®—åŠ¹æœï¼ˆComputational effectï¼‰''ã‚„%
      å˜ã«``åŠ¹æœï¼ˆEffectï¼‰''ã¨è¨€ã†ã“ã¨ã‚‚ã‚ã‚‹ã€‚}%
    ã‚’æŠ½è±¡åŒ–ã™ã‚‹1ã¤ã®æ‰‹æ®µ

    \item<+-> 1ã¤ã®ãƒ¢ãƒŠãƒ‰ã¯1ã¤ã®åŠ¹æœã—ã‹æŠ½è±¡åŒ–ã§ããªã„ãŸã‚ã€
    \lstinline|Reader[Env, Future[Either[Err, Option[A]]]]|ã®ã‚ˆã†ãª
    \emph{ãƒ¢ãƒŠãƒ‰ã‚¹ã‚¿ãƒƒã‚¯}ã‚’ä½¿ã£ã¦è¤‡æ•°ã®åŠ¹æœã‚’è¡¨ç¾ã™ã‚‹
    \begin{itemize}
      \item<+-> ã—ã‹ã—ã“ã†ã™ã‚‹ã¨\lstinline|for|å¼ã§å†…å´ã®ãƒ¢ãƒŠãƒ‰ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã«ãããªã‚‹\ce{ğŸ˜}
    \end{itemize}

    \item<+-> \textbf{ãƒ¢ãƒŠãƒ‰ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒ¼}ã¯ã“ã®ã‚ˆã†ãªå•é¡Œã‚’è§£æ±ºã™ã‚‹ãŒã€
    ã‚ã‚‹ãƒ¢ãƒŠãƒ‰ã«ã¤ã„ã¦å°‚ç”¨ã®ãƒ¢ãƒŠãƒ‰ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒ¼ãŒå¿…è¦\ce{ğŸ˜}

    \item<+-> \emph{Extensible Effects}ã¯ç‰¹åˆ¥ãªä»•çµ„ã¿ãªã—ã«
    ãƒ¢ãƒŠãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ã‚’è¡¨ç¾å¯èƒ½\ce{ğŸ˜„}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{\Fujitask ã¨Extensible Effects}

  \begin{itemize}
    \item<+-> \Fujitask ã¯ã‚µãƒ–ã‚¿ã‚¤ãƒ—ãŒå¿…è¦

    \item<+-> Extensible Effectsã¯Haskellç”Ÿã¾ã‚Œã€
    ã§ã‚‚ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã¯ãªã„ï¼
  \end{itemize}

  \uncover<+->{
    \simplecallout{-}{blue!20}{\Fujitask ã‚’Extensible Effectsã¸æŒã£ã¦ã„ã‘ã‚‹ã‹ï¼Ÿ}
  }

  \begin{itemize}
    \item<+-> ã­ã“ã¯ã‚‹ï¼ˆ\texttt{@halcat0x15a}ï¼‰ã•ã‚“ã®ä½œã£ãŸ
    \href{https://github.com/halcat0x15a/kits-eff}{kits-eff}ã‚’åˆ©ç”¨
    \begin{itemize}
      \item \href{https://github.com/atnos-org/eff}{atnos-eff}ã¨ã¯é•ã£ãŸ
      ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã‚’åˆ©ç”¨ã—ãŸExtensible Effectsã®å®Ÿè£…
    \end{itemize}

    \item<+-> ã§ããŸã‚‚ã®ã¯ã“ã“\ce{ğŸ‘‡}\url{https://github.com/y-yu/fujitask-eff}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example}

  \begin{itemize}
    \item<+-> ã“ã†ã„ã†æ„Ÿã˜ã§ã„ã‚ã„ã‚ãªåŠ¹æœã¨ä¸€ç·’ã«\lstinline|for|ã«å…¥ã‚Œã‚‰ã‚Œã‚‹
  \end{itemize}

  \begin{uncoverenv}<.->
\begin{lstlisting}[style=scala]
case class User(id: Long, name: String)
// create table `user` (
//   `id` bigint not null auto_increment,
//   `name` varchar(64) not null
// )

val eff = for {
  name <- Reader.ask[String]
  user  <- userRepository.create(name)
} yield {
  logger.info(s"user is \$user")
}
Fujitask.run(Reader.run("piyo")(eff)) 
\end{lstlisting}

\begin{lstlisting}[style=plain]
ReadWriteRunner begin --------->
user is Some(User(2,piyo))
<--------- ReadWriteRunner end
\end{lstlisting}  
  \end{uncoverenv}
 
  \begin{itemize}
    \item<+-> ãƒ‡ãƒ¢
    \item<+-> ä»Šå›ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã®\lstinline|flatMap|ã ã‘è¦‹ã¦ã¿ã¾ã—ã‚‡ã†
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{\Fujitask ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼}

\begin{lstlisting}[style=scala]
object Fujitask {
  def run[I <: Transaction: Manifest, A](
    eff: Eff[I, A]
  )(
    implicit runner: FujitaskRunner[I],
    ec: ExecutionContext
  ): Future[A] = {
    def handle(i: I) = new ApplicativeInterpreter[Fujitask, Any] {
      def flatMap[T, B](fa: Fujitask with Fx[T])(k: T => Eff[Any, Future[B]]): Eff[Any, Future[B]] =
        fa match {
          case Execute(f) =>
            Eff.Pure(f(ec).flatMap(a => Eff.run(k(a))))
          case _: Ask[I] =>
            k(i.asInstanceOf[T])
        }
    }
}
\end{lstlisting}

  \begin{itemize}
    \item<+-> \ce{ğŸ™„}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{\Fujitask ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼}

  \begin{itemize}
    \item<+-> è§£èª¬ã—ã‚ˆã†ã¨æ€ã£ãŸã‚‚ã®ã®ã€ã¡ã‚‡ã£ã¨æ™‚é–“ãŒãªã„â€¦â€¦\ce{ğŸ˜‡}

    \item<+-> ä»Šå›ã¯ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ã§å‹˜å¼ã—ã¦ãã ã•ã„\ce{ğŸ™‡}

    \item<+-> è§£èª¬è³‡æ–™\cite{qiita_fujitask_eff}ãŒã‚ã‚‹ã®ã§
    èˆˆå‘³ãŒã§ãŸäººã¯ã“ã‚Œã‚’èª­ã‚“ã§ï¼

    \item<+-> å®Ÿã¯ãƒ¢ãƒŠãƒ‰ç‰ˆã¯ãƒˆãƒ©ãƒãƒªãƒ³ã—ã¦ãªã„ã‘ã©ã€
    ä¸€æ–¹ã§kits-effã¯\emph{Type Aligned Sequence}ã«ã‚ˆã£ã¦
    ã‚¹ã‚¿ãƒƒã‚¯ã‚»ãƒ¼ãƒ•ã«ãªã£ã¦ã„ã‚‹

    \item<+-> ã‚ã¨ã€kits-effã¯\cite{shinchoku}ã‚’èª­ã‚€ã¨ã„ã„ã§ã™
  \end{itemize}
\end{frame}

\section{ã¾ã¨ã‚}

\begin{frame}
  \frametitle{ã¾ã¨ã‚}

  \pause
  \begin{itemize}
    \item<+-> \Fujitask ã¯é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã®ã‚ˆã„èåˆ
  \end{itemize}
\end{frame}

\section*{å‚è€ƒæ–‡çŒ®}

\begin{frame}
  \frametitle{å‚è€ƒæ–‡çŒ®}

  \bibliographystyle{junsrt_url}
  \nocite{*}
  \bibliography{ref}
\end{frame}

\begin{frame}
  \centering
  {\Huge Thank you for your attention!}
\end{frame}

\end{document}
